name: Discord Issue Updates

on:
  issues:
    types: [opened, closed, reopened]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send issue update to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_ISSUES_WEBHOOK }}
          DISCORD_CONTRIBUTOR_ROLE_ID: ${{ secrets.DISCORD_CONTRIBUTOR_ROLE_ID }}
        run: |
          EVENT="${{ github.event.action }}"
          TITLE="${{ github.event.issue.title }}"
          URL="${{ github.event.issue.html_url }}"
          USER="${{ github.event.issue.user.login }}"

          PING=""
          if [ "$EVENT" = "opened" ]; then
            PING="<@&${DISCORD_CONTRIBUTOR_ROLE_ID}>"
          fi

          curl -H "Content-Type: application/json" \
            -d "{
              \"content\": \"${PING} ðŸ“Œ **Issue ${EVENT}**\n**${TITLE}**\nBy: ${USER}\n${URL}\"
            }" \
            $DISCORD_WEBHOOK_URL
